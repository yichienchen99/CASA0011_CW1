<pre><font color="#007f69">globals</font><font color="#000000">[<br />  </font><font color="#5a5a5a">; initial-population</font><font color="#000000"><br />  </font><font color="#5a5a5a">; minimum-sugar-endowment</font><font color="#000000"><br />  </font><font color="#5a5a5a">; maximum-sugar-endowment</font><font color="#000000"><br />  </font><font color="#5a5a5a">; maximum-metabolism</font><font color="#000000"><br />  </font><font color="#5a5a5a">; maximum-vision</font><font color="#000000"><br />  </font><font color="#5a5a5a">; grow-back-rate</font><font color="#000000"><br />  cap-history<br />  ratio-history<br />  crop-history<br />]<br /><br /></font><font color="#007f69">turtles-own</font><font color="#000000"> [<br />  sugar           </font><font color="#5a5a5a">;; the amount of sugar this turtle has</font><font color="#000000"><br />  metabolism      </font><font color="#5a5a5a">;; the amount of sugar that each turtles loses each tick</font><font color="#000000"><br />  vision          </font><font color="#5a5a5a">;; the distance that this turtle can see in the horizontal and vertical directions</font><font color="#000000"><br />  vision-points   </font><font color="#5a5a5a">;; the points that this turtle can see in relative to it's current position (based on vision)</font><font color="#000000"><br />  sugar-history<br />]<br /><br /></font><font color="#007f69">patches-own</font><font color="#000000"> [<br />  psugar           </font><font color="#5a5a5a">;; the amount of sugar on this patch</font><font color="#000000"><br />  max-psugar       </font><font color="#5a5a5a">;; the maximum amount of sugar that can be on this patch</font><font color="#000000"><br />]<br /><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /></font><font color="#5a5a5a">;; Setup Procedures</font><font color="#000000"><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup<br />  </font><font color="#0000aa">if</font><font color="#000000"> maximum-sugar-endowment </font><font color="#660096">&lt;=</font><font color="#000000"> minimum-sugar-endowment [<br />    </font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;Oops: the maximum-sugar-endowment must be larger than the minimum-sugar-endowment&quot;</font><font color="#000000"><br />    </font><font color="#0000aa">stop</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">clear-all</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> cap-history []<br />  </font><font color="#0000aa">set</font><font color="#000000"> ratio-history []<br />  </font><font color="#0000aa">set</font><font color="#000000"> crop-history []<br />  </font><font color="#0000aa">create-turtles</font><font color="#000000"> initial-population [<br />    turtle-setup<br />    </font><font color="#0000aa">set</font><font color="#000000"> sugar-history []<br />    ]<br />  setup-patches<br />  </font><font color="#0000aa">reset-ticks</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> turtle-setup </font><font color="#5a5a5a">;; turtle procedure</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">move-to</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles-here</font><font color="#000000">]<br />  </font><font color="#0000aa">set</font><font color="#000000"> sugar random-in-range minimum-sugar-endowment maximum-sugar-endowment<br />  </font><font color="#0000aa">set</font><font color="#000000"> metabolism random-in-range </font><font color="#963700">1</font><font color="#000000"> maximum-metabolism<br />  </font><font color="#0000aa">set</font><font color="#000000"> vision random-in-range </font><font color="#963700">1</font><font color="#000000"> maximum-vision<br />  </font><font color="#5a5a5a">;; turtles can look horizontally and vertically up to vision patches</font><font color="#000000"><br />  </font><font color="#5a5a5a">;; but cannot look diagonally at all</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> vision-points []<br />  </font><font color="#0000aa">foreach</font><font color="#000000"> (</font><font color="#660096">range</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> (vision </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)) [ n -&gt;<br />    </font><font color="#0000aa">set</font><font color="#000000"> vision-points </font><font color="#660096">sentence</font><font color="#000000"> vision-points (</font><font color="#660096">list</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> n) (</font><font color="#660096">list</font><font color="#000000"> n </font><font color="#963700">0</font><font color="#000000">) (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> (</font><font color="#660096">-</font><font color="#000000"> n)) (</font><font color="#660096">list</font><font color="#000000"> (</font><font color="#660096">-</font><font color="#000000"> n) </font><font color="#963700">0</font><font color="#000000">))<br />  ]<br />  </font><font color="#0000aa">run</font><font color="#000000"> visualization<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup-patches<br />  </font><font color="#0000aa">file-open</font><font color="#000000"> </font><font color="#963700">&quot;sugar-map.txt&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">foreach</font><font color="#000000"> </font><font color="#660096">sort</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [ p -&gt;<br />    </font><font color="#0000aa">ask</font><font color="#000000"> p [<br />      </font><font color="#0000aa">set</font><font color="#000000"> max-psugar </font><font color="#660096">file-read</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> psugar max-psugar<br />      patch-recolor<br />    ]<br />  ]<br />  </font><font color="#0000aa">file-close</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /></font><font color="#5a5a5a">;; Runtime Procedures</font><font color="#000000"><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> go<br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1000</font><font color="#000000"><br />  [<br />    </font><font color="#0000aa">stop</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">set</font><font color="#000000"> cap-history </font><font color="#660096">lput</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">) cap-history<br />  </font><font color="#0000aa">set</font><font color="#000000"> ratio-history </font><font color="#660096">lput</font><font color="#000000"> ratio ratio-history<br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> ((</font><font color="#660096">item</font><font color="#000000"> </font><font color="#660096">ticks</font><font color="#000000"> cap-history) </font><font color="#660096">=</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> (</font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">) cap-history))<br />  [ </font><font color="#0000aa">set</font><font color="#000000"> crop-history </font><font color="#660096">lput</font><font color="#000000"> ratio crop-history]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [<br />    patch-growback<br />    patch-recolor<br />  ]<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />    turtle-move<br />    turtle-eat<br />    </font><font color="#0000aa">if</font><font color="#000000"> sugar </font><font color="#660096">&lt;=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"><br />      [ </font><font color="#0000aa">die</font><font color="#000000"> ]<br />    </font><font color="#5a5a5a">;set sugar-history lput ratio sugar-history</font><font color="#000000"><br />    </font><font color="#0000aa">run</font><font color="#000000"> visualization<br />]<br /><br />  </font><font color="#0000aa">tick</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> turtle-move </font><font color="#5a5a5a">;; turtle procedure</font><font color="#000000"><br />  </font><font color="#5a5a5a">;; consider moving to unoccupied patches in our vision, as well as staying at the current patch</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> move-candidates (</font><font color="#660096">patch-set</font><font color="#000000"> </font><font color="#660096">patch-here</font><font color="#000000"> (</font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">at-points</font><font color="#000000"> vision-points) </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">turtles-here</font><font color="#000000">])<br />  </font><font color="#0000aa">let</font><font color="#000000"> possible-winners move-candidates </font><font color="#660096">with-max</font><font color="#000000"> [psugar]<br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> possible-winners [<br />    </font><font color="#5a5a5a">;; if there are any such patches move to one of the patches that is closest</font><font color="#000000"><br />    </font><font color="#0000aa">move-to</font><font color="#000000"> </font><font color="#660096">min-one-of</font><font color="#000000"> possible-winners [</font><font color="#660096">distance</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000">]<br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> turtle-eat </font><font color="#5a5a5a">;; turtle procedure</font><font color="#000000"><br />  </font><font color="#5a5a5a">;; metabolize some sugar, and eat all the sugar on the current patch</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> sugar (sugar </font><font color="#660096">-</font><font color="#000000"> metabolism </font><font color="#660096">+</font><font color="#000000"> psugar)<br />  </font><font color="#0000aa">set</font><font color="#000000"> psugar </font><font color="#963700">0</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> patch-recolor </font><font color="#5a5a5a">;; patch procedure</font><font color="#000000"><br />  </font><font color="#5a5a5a">;; color patches based on the amount of sugar they have</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> (</font><font color="#963700">yellow</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">4.9</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> psugar)<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> patch-growback </font><font color="#5a5a5a">;; patch procedure</font><font color="#000000"><br />  </font><font color="#5a5a5a">;; gradually grow back all of the sugar for the patch</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> psugar </font><font color="#660096">min</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> max-psugar (psugar </font><font color="#660096">+</font><font color="#000000"> grow-back-rate))<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /></font><font color="#5a5a5a">;; Utilities</font><font color="#000000"><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> random-in-range [low high]<br />  </font><font color="#0000aa">report</font><font color="#000000"> low </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> (high </font><font color="#660096">-</font><font color="#000000"> low </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /></font><font color="#5a5a5a">;; Visualization Procedures</font><font color="#000000"><br /></font><font color="#5a5a5a">;;</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> no-visualization </font><font color="#5a5a5a">;; turtle procedure</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> color-agents-by-vision </font><font color="#5a5a5a">;; turtle procedure</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> (vision </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">3.5</font><font color="#000000">)<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> color-agents-by-metabolism </font><font color="#5a5a5a">;; turtle procedure</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (metabolism </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2.5</font><font color="#000000">)<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#5a5a5a">;</font><font color="#000000"><br /></font><font color="#5a5a5a">; find the percentiles</font><font color="#000000"><br /></font><font color="#5a5a5a">; https://stackoverflow.com/questions/54418736/how-to-use-netlogo-to-find-a-quartile-or-quintile</font><font color="#000000"><br /></font><font color="#5a5a5a">;</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> calc-pct [ #pct #vals ]<br />  </font><font color="#0000aa">let</font><font color="#000000"> #listvals </font><font color="#660096">sort</font><font color="#000000"> #vals<br />  </font><font color="#0000aa">let</font><font color="#000000"> #pct-position #pct </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">length</font><font color="#000000"> #vals<br />  </font><font color="#5a5a5a">; find the ranks and values on either side of the desired percentile</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> #low-rank </font><font color="#660096">floor</font><font color="#000000"> #pct-position<br />  </font><font color="#0000aa">let</font><font color="#000000"> #low-val </font><font color="#660096">item</font><font color="#000000"> #low-rank #listvals<br />  </font><font color="#0000aa">let</font><font color="#000000"> #high-rank </font><font color="#660096">ceiling</font><font color="#000000"> #pct-position<br />  </font><font color="#0000aa">let</font><font color="#000000"> #high-val </font><font color="#660096">item</font><font color="#000000"> #high-rank #listvals<br />  </font><font color="#5a5a5a">; interpolate</font><font color="#000000"><br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> #high-rank </font><font color="#660096">=</font><font color="#000000"> #low-rank<br />  [ </font><font color="#0000aa">report</font><font color="#000000"> #low-val ]<br />  [ </font><font color="#0000aa">report</font><font color="#000000"> #low-val </font><font color="#660096">+</font><font color="#000000"> ((#pct-position </font><font color="#660096">-</font><font color="#000000"> #low-rank) </font><font color="#660096">/</font><font color="#000000"> (#high-rank </font><font color="#660096">-</font><font color="#000000"> #low-rank)) </font><font color="#660096">*</font><font color="#000000"> (#high-val </font><font color="#660096">-</font><font color="#000000"> #low-val) ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> top-20<br />  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">mean</font><font color="#000000"> [sugar] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [sugar </font><font color="#660096">&gt;=</font><font color="#000000"> (calc-pct </font><font color="#963700">80</font><font color="#000000"> [sugar] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">)]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> bottom-20<br />  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">mean</font><font color="#000000"> [sugar] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [sugar </font><font color="#660096">&lt;=</font><font color="#000000"> (calc-pct </font><font color="#963700">20</font><font color="#000000"> [sugar] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">)]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> ratio<br />  </font><font color="#0000aa">report</font><font color="#000000"> (top-20 </font><font color="#660096">/</font><font color="#000000"> bottom-20)<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> maxi-ratio<br />  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">max</font><font color="#000000"> ratio-history<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> crop-ratio<br />  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">mean</font><font color="#000000"> crop-history<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /><br /></font><font color="#5a5a5a">; Copyright 2009 Uri Wilensky.</font><font color="#000000"><br /></font><font color="#5a5a5a">; See Info tab for full copyright and license.</font>
</pre>
